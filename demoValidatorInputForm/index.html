<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="main">

        <form action="" method="POST" class="form" id="form-1">
            <h3 class="heading">Thành viên đăng ký</h3>
            <p class="desc">Cùng nhau học lập trình miễn phí tại F8 ❤️</p>

            <div class="spacer"></div>

            <div class="form-group">
                <label for="username" class="form-label">Tên đầy đủ</label>
                <input id="username" name="username" type="text" placeholder="VD: Sơn Đặng" class="form-control">
                <span class="form-1-message-username"></span>
            </div>
             <div class="form-group">
                <label for="email" class="form-label">Email</label>
                <input id="email" name="email" type="text" placeholder="VD: email@domain.com" class="form-control">
                <span class="form-1-message-email"></span>
            </div>

            <div class="form-group">
                <label for="password" class="form-label">Mật khẩu</label>
                <input id="password" name="password" type="password" placeholder="Nhập mật khẩu" class="form-control">
                <span class="form-1-message-password"></span>
            </div>

            <div class="form-group">
                <label for="password_confirmation" class="form-label">Nhập lại mật khẩu</label>
                <input id="password_confirmation" name="password_confirmation" placeholder="Nhập lại mật khẩu"
                    type="password" class="form-control">
                <span class="form-1-message-password_confirmation"></span>
            </div>

            <button class="form-submit">Đăng ký</button>
        </form>
    </div>

    <script>
        let id = (id) => document.getElementById(id);
        let querySelector = (querySelector) => document.querySelector(querySelector);

        class Validator {
            constructor(form, listInputForm, templateFormMessage) {
                this.form = form;
                this.listInputForm = listInputForm;
                this.templateFormMessage = templateFormMessage;
            }

            getAllSelector() {
                this.selectorForm = id(this.form);
                this.listSelectorInputForm = [];
                this.listInputForm.forEach((inputForm) => {
                    let selectorInputForm = querySelector(inputForm.getSelector);
                    let typeInputForm = inputForm.getType;
                    this.listSelectorInputForm.push({selectorInputForm, typeInputForm});
                });
            }

            isUsername(selectorInputUsername) {
                if(selectorInputUsername.value.trim() === "") {
                    return "Invalid username";
                }
                return "";
            }
            
            isEmail(selectorInputEmail) {
                let email = selectorInputEmail.value;
                if(email.length <= 10 || email.substring(email.length - 10, email.length) != "@gmail.com") {
                    return "Invalid email";
                }
                return "";
            }

            isPassword(selectorInputPassword) {
                if(selectorInputPassword.value.trim() === "") {
                    return "Invalid password";
                }
                return "";
            }

            isPasswordConfirmation(selectorInputPasswordConfirmation) {
                let idSelectorInputPasswork = 0;
                for(let i = 0; i < this.listSelectorInputForm.length; i++) {
                    if(this.listSelectorInputForm[i].typeInputForm == "password") {
                        idSelectorInputPasswork = i;
                        break;
                    }
                }
                let selectorInputPassword = this.listSelectorInputForm[idSelectorInputPasswork].selectorInputForm;
                let password = selectorInputPassword.value;
                let passwordConfirmation = selectorInputPasswordConfirmation.value;
                if(password.trim() === "" || password != passwordConfirmation) {
                    return "Invalid password";
                }
                return "";
            }

            checkForm() {
                this.getAllSelector();
                for(let i = 0; i < this.listSelectorInputForm.length; i++) {
                    let {selectorInputForm, typeInputForm} = this.listSelectorInputForm[i];
                    let text;
                    let formSelectorMessage = querySelector(this.templateFormMessage + typeInputForm);
                    if(typeInputForm == "username") {
                        text = this.isUsername(selectorInputForm);
                    }
                    if(typeInputForm == "email") {
                        text = this.isEmail(selectorInputForm);
                    }
                    if(typeInputForm == "password") {
                        text = this.isPassword(selectorInputForm);
                    }
                    if(typeInputForm == "password_confirmation") {
                        text = this.isPasswordConfirmation(selectorInputForm);
                    }
                    formSelectorMessage.textContent = text;
                    if(text != "")
                        return false;
                }
                return true;
            }
        }

        class InputForm {
            constructor(selector, type) {
                this.selector = selector;
                this.type = type;
            }

            get getSelector() {
                return this.selector;
            }

            get getType() {
                return this.type;
            }
        }

        let form = "form-1";
        let listInputForm = [
            new InputForm("input#username.form-control", "username"),
            new InputForm("input#email.form-control", "email"),
            new InputForm("input#password.form-control", "password"),
            new InputForm("input#password_confirmation.form-control", "password_confirmation"),
        ];
        let templateFormMessage = ".form-1-message-";

        let checkForm = new Validator(form, listInputForm, templateFormMessage);
        let selectorFrom = id(form);
        selectorFrom.addEventListener('submit', (e) => {
            let valid = checkForm.checkForm();
            if(valid == false) {
                e.preventDefault();
            }
        });
    </script>
</body>

</html>